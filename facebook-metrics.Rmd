---
title: "facebook-metrics"
author: "Ryan Nie"
date: "10/29/2023"
output:
  pdf_document: default
  html_document: default
---

```{r data, include=FALSE, echo=FALSE}
library(tidyverse)
df <- read.csv("data/dataset_Facebook.csv",header=T,sep=";")
df
```

```{r descriptive}
sapply(df, function(x) sum(is.na(x)))
data.frame(do.call(cbind, lapply(na.omit(df), summary)))
```

```{r ColMapping}
colmapping <- letters[0:ncol(df)]
tibble(colnames(df), colmapping)
mapped_df <- df %>% rename(!!!setNames(names(.), colmapping))
```

```{r cor}
library(reshape2)
numerical_df <- mapped_df[sapply(mapped_df, is.numeric)]
corr_mat <- cor(numerical_df, use = "complete.obs")

melted_corr <- melt(corr_mat)
ggplot(data = melted_corr, aes(x = Var1, y = Var2, fill = value)) +
  geom_tile() +
  scale_fill_gradient2(
    low = "blue",
    high = "red",
    mid = "white",
    midpoint = 0,
    limit = c(-1, 1),
    space = "Lab",
    name = "Pearson\nCorrelation"
  ) +
  scale_x_discrete(expand = c(0, 0)) +
  scale_y_discrete(expand = c(0, 0)) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 0)) + 
  ggtitle("Correlation Matrix of Continuous Variables")

ggsave(file="cor.png") #, width=20, height=25, dpi=300)
```

```{r pairCor}
library(GGally)
num_df <- na.omit(numerical_df)
ggpairs(num_df, progress = FALSE, 
        upper = list(continuous = wrap("cor", size = 1)),
        lower = list(continuous = wrap("points", alpha = 0.3,    size=0.05)),
        title = "Pairs Plot of Facebook Metrics") +
  theme(axis.line=element_blank(), 
        axis.text=element_blank(),
        axis.ticks=element_blank())

ggsave(file='pairCor.png')
```

```{r modelUpdatedData}
library(caret)
model_df <- read.csv('data/facebook_updated.csv')
train_df <- model_df %>% filter(obs_type == 'Training') %>% select(c(Lifetime.Post.Consumers, Category, Page.total.likes, Type, Post.Month, Post.Hour, Post.Weekday, Paid))
transform <- train_df %>% select(c(Lifetime.Post.Consumers, Page.total.likes, Post.Month, Post.Hour, Post.Weekday))

boxcox_result <- preProcess(transform, method = "BoxCox")
boxcox_result
transformed_data <- predict(boxcox_result, newdata = transform)
transformed_data <- cbind(transformed_data, train_df$Type, train_df$Category, train_df$Paid)
transformed_data

m <-
  lm(
    Lifetime.Post.Consumers ~ factor(train_df$Category) + Page.total.likes + factor(train_df$Type) +
      Post.Month + Post.Hour + Post.Weekday + factor(train_df$Paid),
    data = transformed_data
  )
summary(m)
```


